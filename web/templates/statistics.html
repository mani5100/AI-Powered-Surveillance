{% extends "base.html" %}

{% block title %}Statistics - Security Surveillance{% endblock %}

{% block extra_head %}
<!-- Chart.js Library -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="mb-8">
    <h1 class="text-4xl font-bold text-gray-800 mb-2">Statistics & Analytics</h1>
    <p class="text-gray-600">Visual analysis of detection data and trends</p>
</div>

<!-- Loading State -->
<div id="loading-state" class="text-center py-12">
    <i class="fas fa-spinner fa-spin text-4xl text-gray-400 mb-4"></i>
    <p class="text-gray-500">Loading statistics...</p>
</div>

<!-- Statistics Content -->
<div id="stats-content" class="hidden space-y-8">
    <!-- Summary Cards -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
        <!-- Total Events Card -->
        <div class="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-md p-6 text-white">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold opacity-90">Total Events</h3>
                <i class="fas fa-chart-line text-3xl opacity-75"></i>
            </div>
            <p class="text-4xl font-bold" id="totalEvents">0</p>
            <p class="text-sm opacity-75 mt-2">All-time detections</p>
        </div>
        
        <!-- Average Confidence Card -->
        <div class="bg-gradient-to-br from-green-500 to-green-600 rounded-lg shadow-md p-6 text-white">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold opacity-90">Avg Confidence</h3>
                <i class="fas fa-percentage text-3xl opacity-75"></i>
            </div>
            <p class="text-4xl font-bold" id="avgConfidence">0%</p>
            <p class="text-sm opacity-75 mt-2">Detection accuracy</p>
        </div>
        
        <!-- This Week Card -->
        <div class="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-md p-6 text-white">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold opacity-90">This Week</h3>
                <i class="fas fa-calendar-week text-3xl opacity-75"></i>
            </div>
            <p class="text-4xl font-bold" id="thisWeekEvents">0</p>
            <p class="text-sm opacity-75 mt-2">Past 7 days</p>
        </div>
        
        <!-- Most Detected Card -->
        <div class="bg-gradient-to-br from-red-500 to-red-600 rounded-lg shadow-md p-6 text-white">
            <div class="flex items-center justify-between mb-2">
                <h3 class="text-lg font-semibold opacity-90">Top Threat</h3>
                <i class="fas fa-exclamation-triangle text-3xl opacity-75"></i>
            </div>
            <p class="text-2xl font-bold capitalize" id="topThreat">-</p>
            <p class="text-sm opacity-75 mt-2">Most detected</p>
        </div>
    </div>

    <!-- Charts Row 1 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Events by Object Type Chart -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="relative" style="height: 350px;">
                <canvas id="eventsByTypeChart"></canvas>
            </div>
        </div>
        
        <!-- Events Over Time Chart -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="relative" style="height: 350px;">
                <canvas id="eventsOverTimeChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Charts Row 2 -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- Confidence Distribution Chart -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="relative" style="height: 350px;">
                <canvas id="confidenceChart"></canvas>
            </div>
        </div>
        
        <!-- Hourly Detection Pattern Chart -->
        <div class="bg-white rounded-lg shadow-md p-6">
            <div class="relative" style="height: 350px;">
                <canvas id="hourlyPatternChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Detailed Statistics Table -->
    <div class="bg-white rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold text-gray-800 mb-4">
            <i class="fas fa-table text-gray-600 mr-2"></i>Object Type Breakdown
        </h2>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Object Type
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Count
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Percentage
                        </th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                            Avg Confidence
                        </th>
                    </tr>
                </thead>
                <tbody id="eventTypeTableBody" class="bg-white divide-y divide-gray-200">
                    <!-- Will be populated by JavaScript -->
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Empty State -->
<div id="empty-state" class="hidden text-center py-12">
    <i class="fas fa-chart-bar text-6xl text-gray-300 mb-4"></i>
    <p class="text-gray-500 text-lg">No data available</p>
    <p class="text-gray-400">Events will appear here once detection starts</p>
</div>

{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/statistics.js') }}"></script>
{% endblock %}
